(()=>{"use strict";var t="https://mesto.nomoreparties.co/v1/wff-cohort-17/",e=function(t){if(t.ok)return t.json()},n="users/me",r="cards",o="cards/likes",c={Authorization:"b6e7dc81-0f1c-49fc-b4a4-e7099bace48e","Content-Type":"application/json"};function a(n,r,a){var i,u;r.classList.contains("card__like-button_is-active")?(i=n._id,u=t+"".concat(o,"/").concat(i),fetch(u,{method:"DELETE",headers:c}).then(e)).then((function(t){r.classList.remove("card__like-button_is-active"),a.textContent=t.likes.length})).catch((function(t){console.error("Ошибка ".concat(t))})):function(n){var r=t+"".concat(o,"/").concat(n);return fetch(r,{method:"PUT",headers:c}).then(e)}(n._id).then((function(t){r.classList.add("card__like-button_is-active"),a.textContent=t.likes.length})).catch((function(t){console.error("Ошибка ".concat(t))}))}function i(t,e,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__title");a.src=t.link,a.alt=t.name,i.textContent=t.name;var u=c.querySelector(".like_count");u.textContent=t.likes.length;var l=c.querySelector(".card__delete-button");t.owner._id===o?l.addEventListener("click",(function(n){e(n,t._id)})):l.remove(),a.addEventListener("click",(function(){n(t)}));var s=c.querySelector(".card__like-button");return s.addEventListener("click",(function(){r(t,s,u)})),t.likes.some((function(t){return t._id===o}))&&s.classList.add("card__like-button_is-active"),c}function u(t){t.target.closest(".card").remove()}function l(t){t.classList.add("popup_is-animated"),t.classList.add("popup_is-opened"),document.addEventListener("keydown",s),t.addEventListener("click",d)}function s(t){"Escape"===t.key&&p(document.querySelector(".popup_is-opened"))}function d(t){t.target===t.currentTarget&&p(t.currentTarget)}function f(t){p(t.target.closest(".popup"))}function p(t){t.classList.remove("popup_is-opened"),t.removeEventListener("click",d),document.removeEventListener("keydown",s)}var m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},v=function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(m.inputErrorClass),n.classList.remove(m.errorClass),n.textContent=""},_=function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?v(t,e):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(m.inputErrorClass),r.textContent=n,r.classList.add(m.errorClass)}(t,e,e.validationMessage)},y=function(t,e){h(t)?(e.setAttribute("disabled",!0),e.classList.add(m.inactiveButtonClass)):(e.removeAttribute("disabled",!1),e.classList.remove(m.inactiveButtonClass))},h=function(t){return t.some((function(t){return!t.validity.valid}))},b=function(t){var e=Array.from(t.querySelectorAll(m.inputSelector)),n=t.querySelector(m.submitButtonSelector);n.setAttribute("disabled",!0),n.classList.add(m.inactiveButtonClass),e.forEach((function(e){v(t,e),e.setCustomValidity("")}))};function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var C=document.querySelector(".places__list"),E=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),g=document.forms.edit_profile,k=g.elements.name,q=g.elements.description,A=document.forms.new_place,x=document.forms.avatar,T=x.elements.avatar,w=A.elements.place_name,B=A.elements.link,O=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),P=document.querySelector(".popup__caption"),M=document.querySelector(".popup__image"),N=document.querySelectorAll(".popup__close"),I=document.querySelector(".popup_type_new-card"),J=document.querySelector(".popup_type_edit"),V=document.querySelector(".popup_type_image"),G=document.querySelector(".popup_type_avatar");function H(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить";e.textContent=t?n:r}function U(){b(G),l(G)}function z(){b(J),l(J),k.value=O.textContent,q.value=j.textContent}function $(t){P.textContent=t.name,M.src=t.link,M.alt=t.name,l(V)}E.addEventListener("click",z),L.addEventListener("click",(function(){b(I),l(I)})),D.addEventListener("click",U),x.addEventListener("submit",(function(r){r.preventDefault();var o,a,i="Сохранение...",u=r.submitter,l=u.textContent;return H(!0,u,i,l),(o=T.value,a=t+"".concat(n,"/avatar"),fetch(a,{method:"PATCH",body:JSON.stringify({avatar:o}),headers:c}).then(e)).then((function(t){console.log(t),D.setAttribute("style","background-image: url('".concat(t.avatar,"')")),U(),x.reset(),p(G)})).catch((function(t){console.error("Ошибка ".concat(t))})).finally((function(){H(!1,u,i,l)}))})),g.addEventListener("submit",(function(r){r.preventDefault();var o="Сохранение...",a=r.submitter,i=a.textContent;return H(!0,a,o,i),function(r,o){var a=t+"".concat(n);return fetch(a,{method:"PATCH",body:JSON.stringify({name:r,about:o}),headers:c}).then(e)}(k.value,q.value).then((function(t){O.textContent=t.name,j.textContent=t.about,z(),g.reset(),p(J)})).catch((function(t){console.error("Ошибка ".concat(t))})).finally((function(){H(!1,a,o,i)}))})),A.addEventListener("submit",(function(n){n.preventDefault();var o="Сохранение...",l=n.submitter,s=l.textContent;return H(!0,l,o,s),function(n,o){var a=t+"".concat(r);return fetch(a,{method:"POST",body:JSON.stringify({name:n,link:o}),headers:c}).then(e)}(w.value,B.value).then((function(t){var e=i(t,u,$,a,Q);C.prepend(e),A.reset(),p(I)})).catch((function(t){console.error("Ошибка ".concat(t))})).finally((function(){H(!1,l,o,s)}))})),N.forEach((function(t){t.addEventListener("click",f)})),Array.from(document.querySelectorAll(m.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=Array.from(t.querySelectorAll(m.inputSelector)),n=t.querySelector(m.submitButtonSelector);y(e,n),e.forEach((function(r){r.addEventListener("input",(function(){_(t,r),y(e,n)}))}))}(t)}));var F,K,Q="";Promise.all([(K=t+"".concat(n),fetch(K,{method:"GET",headers:c}).then(e)),(F=t+"".concat(r),fetch(F,{method:"GET",headers:c}).then(e))]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];!function(t){O.textContent=t.name,j.textContent=t.about,D.setAttribute("style","background-image: url('".concat(t.avatar,"')")),Q=t._id}(o),function(t,e,n,r,o){t.forEach((function(t){var c=i(t,e,n,r,o);C.append(c)}))}(c,u,$,a,Q)})).catch((function(t){console.error("Ошибка ".concat(t))}))})();